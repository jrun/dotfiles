##
# Determine whether or not some programs
# are installed.
##
which emacsclient > /dev/null
emacsclient_installed=$?

# Sometimes I'm on a server that doesn't have git
# installed so I curl the dotfiles tarball. Check
# so things that depend on git can be disabled.
which git > /dev/null
git_installed=$?

##
# rbenv
##
if [[ -d "$HOME/.rbenv" ]]; then
    rbenv_path="$HOME/.rbenv/bin"
    path_prefix="$path_prefix:$rbenv_path"
    alias rb='rbenv'
    eval "$($rbenv_path/rbenv init -)"
fi

##
# path
##
export PATH="$DOTFILES/bin:$path_prefix:/usr/local/bin:/usr/local/sbin:/usr/local/share/npm/bin:$PATH"

##
# Platform specific
##
case `uname` in
    (Darwin)
        export JAVA_HOME='/Library/Java/Home'
        EDITOR='emacsclient --alternate-editor=mate'

        alias bu='brew update'
        alias bout='brew outdated'
        alias bup='brew upgrade'

        vmrun="/Applications/VMware\ Fusion.app/Contents/Library/vmrun"

        ##
        # vmware
        ##
        vmstart() { eval "$vmrun start $1 nogui" }

        alias vmstop="$vmrun stop"
        alias vmls="$vmrun list"

        ;;

    (SunOS)

        export TERM='xterm'
        export PATH="$PATH:/opt/local/bin"
        export CFLAGS="-I /opt/local/include -L /opt/local/lib:$CFLAGS"
        export LD_LIBRARY_PATH="/opt/local/lib:$LD_LIBRARY_PATH"

        ;;
    (*)
        if [ $emacsclient_installed -eq 0 ]; then
            EDITOR="emacsclient --alternate-editor=vim"
        else
            which mg > /dev/null
            mg_installed=$?

            if [ $mg_installed -eq 0 ]; then
                EDITOR='mg'
            else
                EDITOR='vim'
            fi
        fi
        ;;
esac

export EDITOR
export SVN_EDITOR=$EDITOR
export GIT_EDITOR=$EDITOR

export MANPATH="/usr/local/man:/usr/local/git/man:$MANPATH"
export PROJECTS_PATH="$HOME/projects"
export WORK_PROJECTS_PATH="$HOME/work/projects"
export CDPATH=":$WORK_PROJECTS_PATH:$PROJECTS_PATH:$PROJECTS_PATH/oss:$HOME:$CDPATH"
export GOPATH="$PROJECTS_PATH/go:$WORK_PROJECTS_PATH/go"
export NODE_PATH="/usr/local/lib/node_modules"

##
# aliases
##
alias t=touch
alias ..='cd ..'
alias e="$EDITOR --no-wait"
alias sha256='openssl dgst -sha256'

if [ `uname` != 'SunOS' ]; then
    alias grep='grep --color'
fi

# ls
alias ls="ls -F"
alias l="ls -lAh"
alias ll="ls -l"
alias la='ls -A'
alias lt='ls -lt'

# git
alias g='git'
alias gai='git add -i'
alias gap='git add -p'
alias gb='git branch'
alias gc='git commit'
alias gd='git diff'
alias gdc='git diff --cached'
alias gf='git fetch'
alias gl='git lg'
alias gp='git push'
alias s='git status --short'
alias gfo='git fetch origin'
alias gpo='git push origin'

# tmux
alias tls='tmux list-sessions'
alias ta='tmux attach -t '

# ruby
alias bi='bundle install'
alias gemin='gem install'
alias gemun='gem uninstall'
alias gempurge='gem list | cut -d" " -f1 | xargs gem uninstall -aIx'
